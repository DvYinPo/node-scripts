import e from"node:fs";import o from"node:path";import"node:url";import r from"node:child_process";var s={};const n=e,t=o;function i(e){if(!e)return console.log("require project dir!!!"),!1;const o=t.resolve(e,"package.json");let r=!1;if(n.existsSync(o)){const e=function(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}(o);r=e.dependencies?.typescript||e.devDependencies?.typescript}const s=n.existsSync(t.join(e,"tsconfig.json"));return r||s}const c=r,l=o,a=e;var p=s.exportAll=function(e,o,r="esm"){if(!["esm","cjs"].includes(r))return void console.log("mode must be esm or cjs!!!");Array.isArray(e)&&(e=t.resolve(...e)),(o=o.trim().replace(/\/$/,"").trim()).startsWith("./")||o.startsWith("../")||(o="./"+o);const s=i(e)?"index.ts":"index.js",c=t.resolve(e,o);if(!n.existsSync(c))return void console.log(`no such file or directory!!!\n=> ${c}`);const l=n.readdirSync(c).reduce(((e,s)=>{const i=t.resolve(c,s);if(n.statSync(i).isDirectory()){const c=n.existsSync(t.resolve(i,"index.ts")),l=n.existsSync(t.resolve(i,"index.js")),a=[];c&&a.push(t.resolve(i,"index.ts")),l&&a.push(t.resolve(i,"index.js")),a.forEach((t=>{const i=n.readFileSync(t,"utf-8");if("esm"===r){e+=`export * from '${o}/${s}';\n`;i.includes("export default")&&(e+=`export { default as ${s} } from '${o}/${s}';\n`)}else e+=`module.exports.${s} = require('${o}/${s}');\n`}))}else console.log("=> file",i);return e}),"");n.writeFileSync(t.resolve(e,s),l,"utf-8")},u=s.versionCheck=function(e){if(!e)return console.log("require project path!!!"),process.exit(1),!1;Array.isArray(e)&&(e=l.resolve(...e));let o={};try{const r=a.readFileSync(l.resolve(e,"./package.json"),"utf-8");o=JSON.parse(r)}catch(e){return console.log("package.json parse error!!!"),process.exit(1),!1}const r=o.version,s=o.repository.url;if(!s)return console.log("package.json require repository.url !!!"),process.exit(1),!1;return r===c.execSync(`npm show ${s} version`).toString().trim()?(console.log("\nThe local version is not up to date. please update package version before push!\n"),process.exit(1),!1):(console.log("\nThe local version is already up to date.\n"),!0)};export{s as default,p as exportAll,u as versionCheck};
